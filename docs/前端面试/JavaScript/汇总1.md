# æ±‡æ€» 1

## å•çº¿ç¨‹çš„ JavaScript

ä½œä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼ŒJavaScript çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ç”¨æˆ·äº¤äº’å’Œæ“ä½œ DOMã€‚

å¦‚æœ JavaScript æ˜¯å¤šçº¿ç¨‹ï¼Œå½“é¡µé¢æ›´æ–°å†…å®¹çš„æ—¶å€™ï¼Œç”¨æˆ·åˆè§¦å‘äº†äº¤äº’ï¼Œè¿™æ—¶å€™çº¿ç¨‹é—´çš„åŒæ­¥é—®é¢˜ä¼šå¾ˆå¤æ‚ï¼Œä¸ºäº†é¿å…å¤æ‚æ€§ï¼ŒJavaScript è¢«è®¾è®¡ä¸ºå•çº¿ç¨‹ã€‚

### JavaScript è¿è¡Œ

JavaScript è¿è¡Œæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šå½¢æˆä¸€ä¸ªæ ˆï¼Œè¿™ä¸ªæ ˆä¸»è¦æ˜¯è§£é‡Šå™¨ç”¨æ¥æœ€ç»ˆå‡½æ•°æ‰§è¡Œæµçš„ä¸€ç§æœºåˆ¶ã€‚é€šå¸¸è¿™ä¸ªæ ˆè¢«ç§°ä¸ºè°ƒç”¨æ ˆ Call Stackï¼Œæˆ–æ‰§è¡Œæ ˆ Execution Context Stack

è°ƒç”¨æ ˆï¼Œå…·æœ‰åè¿›å…ˆå‡ºçš„ç»“æ„ã€‚

è°ƒç”¨æ ˆå†…å­˜æ”¾çš„æ˜¯ä»£ç æ‰§è¡ŒæœŸé—´çš„æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

- æ¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè§£é‡Šå™¨å°±ä¼šæŠŠè¯¥å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ·»åŠ åˆ°è°ƒç”¨æ ˆå¹¶å¼€å§‹æ‰§è¡Œï¼›

- æ­£åœ¨è°ƒç”¨æ ˆä¸­æ‰§è¡Œçš„å‡½æ•°ï¼Œå¦‚æœè¿˜è°ƒç”¨äº†å…¶ä»–å‡½æ•°ï¼Œé‚£ä¹ˆæ–°å‡½æ•°ä¹Ÿä¼šè¢«æ·»åŠ åˆ°è°ƒç”¨æ ˆï¼Œå¹¶ç«‹å³æ‰§è¡Œï¼›

- å½“å‰å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œè§£é‡Šå™¨ä¼šå°†å…¶æ‰§è¡Œä¸Šä¸‹æ–‡æ¸…é™¤è°ƒç”¨æ ˆï¼Œç»§ç»­æ‰§è¡Œå‰©ä½™æ‰§è¡Œä¸Šä¸‹æ–‡çš„å‰©ä½™ä»£ç 

- åˆ†é…çš„è°ƒç”¨æ ˆç©ºé—´è¢«å æ»¡ï¼Œä¼šå¼•å‘â€œå †æ ˆæº¢å‡ºâ€é”™è¯¯ã€‚

### äº‹ä»¶å¾ªç¯

å•çº¿ç¨‹æ„å‘³ç€ä»»åŠ¡éœ€è¦ä¸€ä¸ªä¸€ä¸ªè¿›è¡Œï¼Œå¦‚æœæœ‰ä»»åŠ¡æ˜¯ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æ“ä½œä¹‹å‰ï¼Œå…¶ä»–ä»»åŠ¡éƒ½ä¼šç­‰å¾…ï¼Œé¡µé¢å¤„äºå‡æ­»çŠ¶æ€ï¼Œä½“éªŒå¾ˆç³Ÿï¼Œæ‰€ä»¥å‡ºç°äº†å¼‚æ­¥ä»»åŠ¡ã€‚

JavaScript ä¸­ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½å¯ä»¥åˆ†ä¸ºï¼š

- åŒæ­¥ä»»åŠ¡ï¼šç«‹å³æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒåŒæ­¥ä»»åŠ¡ä¸€èˆ¬ä¼šç›´æ¥è¿›å…¥åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ

- å¼‚æ­¥ä»»åŠ¡ï¼šå¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚ ajax ç½‘ç»œè¯·æ±‚ï¼ŒsetTimeout å®šæ—¶å‡½æ•°ç­‰

![alt text](image.png)

å¼‚æ­¥ä»»åŠ¡åˆå¯ä»¥åˆ†ä¸ºå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ã€‚

å¸¸è§çš„å®ä»»åŠ¡ï¼š

- script(å¤–å±‚åŒæ­¥ä»£ç )

- setTimeout/setInterval

- UI rendering/UI äº‹ä»¶

- postMessageã€MessageChannel

- setImmediateã€I/O(Node.js)

å¸¸è§çš„å¾®ä»»åŠ¡ï¼š

- Promise.then

- MutationObserver

- Object.observer(å·²åºŸå¼ƒï¼ŒProxy å¯¹è±¡æ›¿ä»£)

- process.nextTickï¼ˆNode.jsï¼‰

`new Promiseæ˜¯åŒæ­¥ä»»åŠ¡ï¼Œç›´æ¥æ‰§è¡Œ`

![alt text](image-1.png)

#### async å’Œ await

async ç”¨æ¥å£°æ˜ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œè€Œ await æ˜¯ç”¨æ¥ç­‰å¾…å¼‚æ­¥æ–¹æ³•æ‰§è¡Œ

async å‡½æ•°è¿”å›ä¸€ä¸ª promise å¯¹è±¡

```js
function f() {
  return Promise.resolve("TEST");
}

async function asyncF() {
  return "TEST";
}
```

æ­£å¸¸æƒ…å†µä¸‹ï¼Œawait å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœ

å¦‚æœä¸æ˜¯ Promise å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼

```js
async function f() {
  return await 123;
  // ç­‰åŒäºreturn 123;
}

f().then((v) => console.log(v));
// 123
```

ä½†ä¸ç®¡ await åé¢è·Ÿç€çš„æ˜¯ä»€ä¹ˆï¼Œawait éƒ½ä¼šé˜»å¡åé¢çš„ä»£ç 

```js
async function fn1() {
  console.log(1);

  await fn2();

  console.log(2); //è¢«é˜»å¡
}

async function fn2() {
  console.log("fn2");
}

fn1();

console.log(3);

// awaitä¼šé˜»å¡ä¸‹é¢çš„ä»£ç ï¼Œå³åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå…ˆæ‰§è¡Œasyncå¤–é¢çš„åŒæ­¥ä»£ç ï¼ŒåŒæ­¥ä»£ç æ‰§è¡Œå®Œï¼Œå†å›åˆ°asyncå‡½æ•°ä¸­ï¼Œå†æ‰§è¡Œä¹‹å‰é˜»å¡çš„ä»£ç 
// 1,fn2,3,2
```

ç¤ºä¾‹ï¼š

```js
async function async1() {
  console.log("async1 start");
  await async2();
  console.log("async1 end");
}
async function async2() {
  console.log("async2");
}
console.log("script start");
setTimeout(function () {
  console.log("settimeout");
});
async1();
new Promise(function (resolve) {
  console.log("promise1");
  resolve();
}).then(function () {
  console.log("promise2");
});
console.log("script end");
// script startã€async1 startã€async2ã€promise1ã€script endã€async1 endã€promise2ã€settimeout
```

#### async/await å…¶ä»–ç»†èŠ‚

```js
async function async1 () {
 Â  Â await new Promise((resolve, reject) => {
 Â  Â  Â  Â resolve()
 Â   })
 Â  Â console.log('A')
}
â€‹
async1()
â€‹
new Promise((resolve) => {
 Â  Â console.log('B')
 Â  Â resolve()
}).then(() => {
 Â  Â console.log('C')
}).then(() => {
 Â  Â console.log('D')
})
â€‹
// æœ€ç»ˆç»“æœğŸ‘‰: B A C D


async function async1 () {
 Â  Â await async2()
 Â  Â console.log('A')
}
â€‹
async function async2 () {
 Â  Â return new Promise((resolve, reject) => {
 Â  Â  Â  Â resolve()
 Â   })
}
â€‹
async1()
â€‹
new Promise((resolve) => {
 Â  Â console.log('B')
 Â  Â resolve()
}).then(() => {
 Â  Â console.log('C')
}).then(() => {
 Â  Â console.log('D')
})
â€‹
// æœ€ç»ˆç»“æœğŸ‘‰: B C D A
```

async å‡½æ•°å¤„ç†è¿”å›å€¼ï¼Œä¼šåƒ Promise.prototype.then ä¸€æ ·ï¼Œä¼šå¯¹è¿”å›å€¼çš„ç±»å‹è¿›è¡Œè¾¨è¯†

ğŸ‘‰ æ ¹æ®è¿”å›å€¼çš„ç±»å‹ï¼Œå¼•èµ· js å¼•æ“ å¯¹è¿”å›å€¼å¤„ç†æ–¹å¼çš„ä¸åŒ

> ğŸ“‘ ç»“è®ºï¼šasync å‡½æ•°åœ¨æŠ›å‡ºè¿”å›å€¼æ—¶ï¼Œä¼šæ ¹æ®è¿”å›å€¼ç±»å‹å¼€å¯ä¸åŒæ•°ç›®çš„å¾®ä»»åŠ¡
>
> - return ç»“æœå€¼ï¼šé thenableã€é promiseï¼ˆä¸ç­‰å¾…ï¼‰
>
> - return ç»“æœå€¼ï¼šthenableï¼ˆç­‰å¾… 1 ä¸ª then çš„æ—¶é—´ï¼‰
>
> - return ç»“æœå€¼ï¼špromiseï¼ˆç­‰å¾… 2 ä¸ª then çš„æ—¶é—´ï¼‰

```js
async function testA () {
 Â  Â return 1;
}
â€‹
testA().then(() => console.log(1));
Promise.resolve()
 Â   .then(() => console.log(2))
 Â   .then(() => console.log(3));
â€‹
// (ä¸ç­‰å¾…)æœ€ç»ˆç»“æœğŸ‘‰: 1 2 3


async function testB () {
 Â  Â return {
 Â  Â  Â  Â then (cb) {
 Â  Â  Â  Â  Â  Â cb();
 Â  Â  Â   }
 Â   };
}
â€‹
testB().then(() => console.log(1));
Promise.resolve()
 Â   .then(() => console.log(2))
 Â   .then(() => console.log(3));
â€‹
// (ç­‰å¾…ä¸€ä¸ªthen)æœ€ç»ˆç»“æœğŸ‘‰: 2 1 3

async function testC () {
Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  resolve()
Â  Â  })
}

testC().then(() => console.log(1));
Promise.resolve()
Â  Â  .then(() => console.log(2))
Â  Â  .then(() => console.log(3));

// (ç­‰å¾…ä¸¤ä¸ªthen)æœ€ç»ˆç»“æœğŸ‘‰: 2 3 1




async function testC () {
Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  resolve()
Â  Â  })
}

testC().then(() => console.log(1));
Promise.resolve()
Â  Â  .then(() => console.log(2))
Â  Â  .then(() => console.log(3))
Â  Â  .then(() => console.log(4))

// (ç­‰å¾…ä¸¤ä¸ªthen)æœ€ç»ˆç»“æœğŸ‘‰: 2 3 1 4

```

```js
async function async1 () {
 Â  Â console.log('1')
 Â  Â await async2()
 Â  Â console.log('AAA')
}
â€‹
async function async2 () {
 Â  Â console.log('3')
 Â  Â return new Promise((resolve, reject) => {
 Â  Â  Â  Â resolve()
 Â  Â  Â  Â console.log('4')
 Â   })
}
â€‹
console.log('5')
â€‹
setTimeout(() => {
 Â  Â console.log('6')
}, 0);
â€‹
async1()
â€‹
new Promise((resolve) => {
 Â  Â console.log('7')
 Â  Â resolve()
}).then(() => {
 Â  Â console.log('8')
}).then(() => {
 Â  Â console.log('9')
}).then(() => {
 Â  Â console.log('10')
})
console.log('11')
â€‹
// æœ€ç»ˆç»“æœğŸ‘‰: 5 1 3 4 7 11 8 9 AAA 10 6

```

è·Ÿ Promise çš„æƒ…å†µ

```js
async function test () {
 Â  Â console.log(1);
 Â  Â await new Promise((resolve, reject) => {
 Â  Â  Â  Â resolve()
 Â   })
 Â  Â console.log(2);
}
â€‹
test();
console.log(3);
â€‹
Promise.resolve()
 Â   .then(() => console.log(4))
 Â   .then(() => console.log(5))
 Â   .then(() => console.log(6))
 Â   .then(() => console.log(7));
â€‹
// æœ€ç»ˆç»“æœğŸ‘‰: 1 3 2 4 5 6 7

// ä¸ºä»€ä¹ˆä¸ç­‰å¾…ä¸¤ä¸ª then çš„æ—¶é—´å‘¢ï¼Ÿ
// TC 39(ECMAScriptæ ‡å‡†åˆ¶å®šè€…) å¯¹await åé¢æ˜¯ promise çš„æƒ…å†µå¦‚ä½•å¤„ç†è¿›è¡Œäº†ä¸€æ¬¡ä¿®æ”¹ï¼Œç§»é™¤äº†é¢å¤–çš„ä¸¤ä¸ªå¾®ä»»åŠ¡ï¼Œåœ¨æ—©æœŸç‰ˆæœ¬ï¼Œä¾ç„¶ä¼šç­‰å¾…ä¸¤ä¸ª then çš„æ—¶é—´
// ä½†åœ¨è¿™æ¬¡æ›´æ–°ä¸­å¹¶æ²¡æœ‰ä¿®æ”¹ thenable çš„æƒ…å†µ
// è¿™æ ·åšå¯ä»¥æå¤§çš„ä¼˜åŒ– await ç­‰å¾…çš„é€Ÿåº¦
```

## äº‹ä»¶å¾ªç¯

JavaScript ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé™¤äº†ä¾é å‡½æ•°`è°ƒç”¨æ ˆ`æ¥æå®šå‡½æ•°çš„æ‰§è¡Œé¡ºåºå¤–ï¼Œè¿˜ä¾é `ä»»åŠ¡é˜Ÿåˆ—(task queue)`æ¥æå®šå¦å¤–ä¸€äº›ä»£ç çš„æ‰§è¡Œã€‚æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¸ºäº‹ä»¶å¾ªç¯è¿‡ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œäº‹ä»¶å¾ªç¯æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯ä»»åŠ¡é˜Ÿåˆ—å¯ä»¥æ‹¥æœ‰å¤šä¸ªã€‚ä»»åŠ¡é˜Ÿåˆ—åˆåˆ†ä¸º macro-taskï¼ˆå®ä»»åŠ¡ï¼‰ä¸ micro-taskï¼ˆå¾®ä»»åŠ¡ï¼‰ï¼Œåœ¨æœ€æ–°æ ‡å‡†ä¸­ï¼Œå®ƒä»¬è¢«åˆ†åˆ«ç§°ä¸º task ä¸ jobsã€‚

æ‰§è¡Œé¡ºåºï¼š

```js
æ‰§è¡ŒåŒæ­¥ä»£ç 

æ‰§è¡Œå®Œæ‰€æœ‰åŒæ­¥ä»£ç åä¸”æ‰§è¡Œæ ˆä¸ºç©ºï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œ

æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ä¸”å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º

æ˜¯å¦æœ‰å¿…è¦æ¸²æŸ“é¡µé¢

æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡
```

macro-task å¤§æ¦‚åŒ…æ‹¬ï¼š

- script(æ•´ä½“ä»£ç )

- setTimeout

- setInterval

- setImmediate

- I/O

- UI render

micro-task å¤§æ¦‚åŒ…æ‹¬:

- process.nextTick

- Promise

- Async/Await(å®é™…å°±æ˜¯ promise)

- MutationObserver(html5 æ–°ç‰¹æ€§)

![alt text](image-2.png)

## æŸ¯é‡ŒåŒ–

æŸ¯é‡ŒåŒ–æ˜¯æŠŠä¸€ä¸ªå¤šå‚å‡½æ•°è½¬åŒ–ä¸ºä¸€ä¸ªåµŒå¥—çš„ä¸€å…ƒå‡½æ•°çš„è¿‡ç¨‹

æŸ¯é‡ŒåŒ–çš„æ„ä¹‰ï¼š

1ã€è®©çº¯å‡½æ•°æ›´çº¯ï¼Œæ¯æ¬¡æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ¾æ•£è§£è€¦

2ã€æƒ°æ€§æ‰§è¡Œ

```js
let fn = (x, y) => x + y;

// è½¬åŒ–

const curry = function (fn) {
  return function (x) {
    return function (y) {
      return fn(x, y);
    };
  };
};

let myfn = curry(fn);
console.log(myfn(1)(2));

// å¤šå‚æ•°
const curry = function (fn) {
  return function curriedFn(...args) {
    if (args.length < fn.length) {
      return function () {
        return curriedFn(...args.concat([...arguments]));
      };
    }
    return fn(...args);
  };
};
const fn = (x, y, z, a) => x + y + z + a;
const myfn = curry(fn);
console.log(myfn(1)(2)(3)(1));
```

## ç²¾åº¦é—®é¢˜

JavaScript ä¸­ Number é‡‡ç”¨çš„æ˜¯ IEEE754 è§„èŒƒä¸­ 64 ä½åŒç²¾åº¦æµ®ç‚¹æ•°ç¼–ç 

è¿™æ ·çš„å‚¨å­˜ç»“æ„ä¼˜ç‚¹æ˜¯å¯ä»¥å½’ä¸€åŒ–å¤„ç†æ•´æ•°å’Œå°æ•°ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´

å¯¹äºæ•´æ•°ï¼Œå¯ä»¥è½»æ˜“è½¬åŒ–æˆåè¿›åˆ¶æˆ–è€…äºŒè¿›åˆ¶ï¼Œä½†å¯¹äºæµ®ç‚¹æ•°ï¼Œå› ä¸ºå°æ•°ç‚¹çš„å­˜åœ¨ï¼Œå°æ•°ç‚¹çš„ä½ç½®ä¸æ˜¯å›ºå®šçš„ï¼Œè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•

ä½†è®¡ç®—æœºåªèƒ½ä½¿ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼ŒäºŒè¿›åˆ¶è½¬æ¢ä¸ºç§‘å­¦è®¡æ•°æ³•çš„å…¬å¼ä¸ºï¼š`x=a*2^e`

å­˜å‚¨äºŒè¿›åˆ¶æ—¶å°æ•°ç‚¹çš„åç§»é‡æœ€å¤§ä¸º 52 ä½ï¼Œæœ€å¤šå¯ä»¥è¡¨è¾¾çš„ä½æ•°æ˜¯`2^53`ï¼Œå¯¹åº”ç§‘å­¦è®¡æ•°çš„å°¾æ•°æ˜¯`9.007199254740992`ï¼Œè¿™æ˜¯ JS æœ€å¤šèƒ½è¡¨ç¤ºçš„ç²¾åº¦

é•¿åº¦æ˜¯ 16ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ toPrecision(16)æ¥åšç²¾åº¦è¿ç®—ï¼Œè¶…è¿‡çš„ç²¾åº¦ä¼šè‡ªåŠ¨åšå‡‘æ•´å¤„ç†

## å‚è€ƒ

[https://juejin.cn/post/6844904079353708557](https://juejin.cn/post/6844904079353708557)

[https://juejin.cn/post/6948626943717670948?from=search-suggest](https://juejin.cn/post/6948626943717670948?from=search-suggest)
