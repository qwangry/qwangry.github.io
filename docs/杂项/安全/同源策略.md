# 同源策略

## 概念

同源策略是一个重要的安全策略，用于限制一个源的文档或者它加载的脚本如何能与另一个源的资源进行交互。

同源策略的目的是防止恶意网站窃取用户在其他网站上的敏感信息或进行未经授权的操作，保护用户数据的安全性和隐私性

如果两个 URL 的协议、主机和端口都相同，就称这两个 URL 同源。

- 协议：是定义了数据如何在计算机内和之间进行交换的规则的系统，如 HTTP，HTTPS

- 主机：是已连接到一个计算机网络的一台电子计算机或其他设备，网络主机可以向网络上的用户或其他节点提供信息资源、服务和应用。使用 TCP/IP 协议簇参与的网络的计算机也可称为 IP 主机

- 端口：主机是计算机到计算机之间的通信，端口是进程和进程之间的通信

同源策略主要表现在三个方面：DOM、Web 数据和网络

- DOM 访问限制：同源策略限制了网页脚本访问其他源的 DOM。这意味着通过脚本无法直接访问跨源页面的 DOM 元素、属性或方法。这是为了防止恶意网站从其他网站窃取敏感信息

- web 数据限制：同源策略也限制了从其他源加载的 web 数据。在同源策略下，XMLHttpRequest 或 Fetch 请求只能发送到与当前网页具有相同源的目标。有助于防止跨站点请求伪造 CSRF 等攻击

- 网络通信限制：同源策略还限制了跨源的网络通信。浏览器会阻止从一个源发出的请求获取来自其他源的响应。这样做是为了确保只有受信任的源能够与服务器进行通信，以避免恶意行为

## 解决方案

代理服务器：位于发起请求的客户端与原始服务器端之间的一台跳板服务器

正向代理可以隐藏客户端，反向代理可以隐藏原始服务器

● 正向代理：客户端<-->代理-->服务端，位于客户端和原始服务器之间的服务器

● 反向代理：客户端-->代理<-->服务端，对于客户端而言它就像原始服务器，并且客户端不需要进行任何特别的设置。客户端向反向代理命名空间中的内容发送普通请求，接着反向代理将判断向何处转交请求，并将获得的内容返回给客户端，就像这些内容原本就是他自己的一样

跨域：cross-origin 是指在网络中，一个源的网页或者网站尝试去访问另一个不同源的资源时发生的情况。“源”：协议、域名、端口号

● 代理：

● CORS：后端配置

● jsonp 前后端协商：

> 原理：script 标签的 src 不受同源策略的限制，但只能使用 get 请求

## 浏览器有同源策略，cdn请求资源为何没有？

一些CDN资源不受同源策略的限制，是因为同源策略主要是浏览器的安全机制，用于限制不同源的文档或脚本之间的交互操作，但对于某些特定类型的资源访问，浏览器会有一些例外操作

在HTML中，`<script>，<img>，<iframe>，<link>`等标签的src属性指向的资源通常是可以跨域访问的，例如，可以通过`<script src="https://cdn.example.com/vue.min.js">`加载cdn资源

这样做的主要原始是为了保证web的开放性和可扩展性，如果这些资源也严格受到同源策略的限制，那么所有相关资源都部署在同一个服务器下会未被Web开放的初衷，并且不利于资源的分发和缓存

注意：然后浏览器允许这些资源的跨域加载，但在加载JavaScript时，会限制对返回内容的读写权限，以防止恶意脚本获取或修改其他域的信息

CDN服务提供商通常也会采取一些措施来确保资源的安全性和合法性，会对资源进行管理和配置，只允许合法的请求访问资源，并防止恶意使用或滥用CDN资源

## 参考

[https://juejin.cn/post/7269952188927017015](https://juejin.cn/post/7269952188927017015)

[https://www.xiaohongshu.com/explore/66fbe39a000000002a031502?xsec_token=AB-0p6_AeeTrndOl6kL7rtktgNCSUO9SqDJi5JX_ae9xM=&xsec_source=pc_user](https://www.xiaohongshu.com/explore/66fbe39a000000002a031502?xsec_token=AB-0p6_AeeTrndOl6kL7rtktgNCSUO9SqDJi5JX_ae9xM=&xsec_source=pc_user)

[https://juejin.cn/post/7274544460104482873](https://juejin.cn/post/7274544460104482873)
