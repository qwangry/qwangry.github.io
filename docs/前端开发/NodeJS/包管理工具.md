# 包管理工具

## Monorepo

`Monorepo`是一种项目代码管理方式，指单个仓库中管理多个项目，有助于简化代码共享、版本控制、构建和部署等方面的复杂性，并提供更好的可重用性和协作性。

### 演进

#### 阶段一、单仓库巨石应用
一个Git仓库维护项目代码，随着迭代业务复杂度的提升，项目代码会变得越来越多，越来越复杂，大量代码构建效率也会降低，最终导致单体巨石应用，这种代码管理方式称为`Monolith`

#### 阶段二、多仓库多模块应用
将项目拆解成多个业务模块，并在多个Git仓库管理，模块解耦，降低巨石应用的复杂度，每个模块都可以独立编码、测试、发版，代码管理变得简化，构建效率也得以提升，这种代码管理方式称为`MultiRepo`

#### 阶段三、单仓库多模块应用
随着业务复杂度的提升，模块仓库越来越多，`MultiRepo`这种方式虽然从业务上解耦了，但增加了项目工程管理的难度，随着模块仓库达到一定数量级，会有几个问题：跨仓库代码难以共享；分散在单仓库的模块依赖管理复杂；增加构建耗时。

于是，将多个项目集成到一个仓库下，共享工程配置，同时又快捷地共享模块代码，成为趋势，这种代码管理方式称之为`MonoRepo`

## 包管理工具

npm, yarn, pnpm等是用来管理项目依赖、发布包、安装依赖的工具，都提供了对工作区（workspace）的支持，允许在单个代码库中管理多个项目或包。

> 这些包管理工具与monorepo的关系在于它们可以为Monorepo提供依赖安装与依赖管理的支持，借助自身对workspace的支持，允许在Monorepo中的不同子项目之间共享依赖项，并提供一种管理这些共享依赖项的方式，这样可以简化依赖项管理和构建过程，并提供开发效率。

### npm
npm（Node Package Manager）是随着Node.js一起发布的包管理和分发工具

#### 优点
1、广泛的社区支持

2、简单易用

3、自动化解决依赖冲突

#### 缺点
1、性能较差
> 安装依赖的速度较慢，尤其是在处理大量依赖时

2、本地缓存管理不足
> 管理本地缓存方面不如Yarn和pnpm高效，可能导致重复下载同一依赖包，浪费时间和带宽

3、锁文件问题
早期的npm版本在处理package-lock.json文件时存在一些问题，虽然在npm5后有所改善，但仍不如Yarn稳定

### yarn
Yarn 是 Facebook 于 2016 年推出的包管理工具，旨在解决 npm 的一些性能和安全性问题

#### 优点
1、速度快
> 通过并行安装和本地缓存显著提高了依赖包的安装速度，会将下载的包缓存到本地，避免了重复下载

2、确定性安装
> lock文件yarn.lock确保了跨环境的一致性安装，避免了不同开发环境之间的版本不一致问题

3、更好的依赖管理
> 在处理依赖树和扁平化依赖结构上做的更好，减少了依赖冲突的发生

4、工作空间
> yarn支持Monorepo，通过workspaces功能，可以在一个仓库中管理多个包，极大的方便了大型项目的依赖管理

#### 缺点

1、学习曲线

2、社区和生态

### pnpm
pnpm 是一种高性能的包管理工具，推出的时间比 Yarn 晚一些，但凭借其独特的硬链接机制和高效的依赖管理方式，迅速获得了很多开发者的认可

#### 优点
1、硬链接机制
> 通过硬链接和符号链接来管理包，这意味着即使在多个项目中使用相同的依赖，也只需要下载一次，大大节省了磁盘空间和下载时间

2、高效的依赖管理
> pnpm 的依赖管理机制能够有效避免依赖重复和版本冲突问题。它使用独特的 node_modules 结构，使得依赖解析更加快速和准确

3、支持Monorepo
> 与 Yarn 类似，pnpm 也支持 Monorepo，可以通过 workspaces 功能在一个仓库中管理多个包，方便大型项目的开发和维护

4、性能优势
> 无论缓存类型（冷或热）如何，PNPM 在速度方面都优于 Yarn。PNPM 速度快的关键在于其文件链接方法，它只需从全局存储中链接文件，而 Yarn 则采用从缓存中复制文件的方法。此外，PNPM 不会在磁盘上多次保存软件包版本，从而确保高效使用磁盘

#### 缺点

1、相对较新

2、学习曲线


## 参考链接
[https://juejin.cn/post/7370008254719803431?searchId=2024071714462180C1A6E3E59E427FF7BF](https://juejin.cn/post/7370008254719803431?searchId=2024071714462180C1A6E3E59E427FF7BF)

[https://juejin.cn/post/7286362110211489855?searchId=20240717150243127DA856A182FA84E564](https://juejin.cn/post/7286362110211489855?searchId=20240717150243127DA856A182FA84E564)

[https://juejin.cn/post/7357546247848198182?searchId=20240717150243127DA856A182FA84E564](https://juejin.cn/post/7357546247848198182?searchId=20240717150243127DA856A182FA84E564)

[https://juejin.cn/post/7215886869199896637?searchId=2024071714462180C1A6E3E59E427FF7BF](https://juejin.cn/post/7215886869199896637?searchId=2024071714462180C1A6E3E59E427FF7BF)